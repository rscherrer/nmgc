# Spatial autocorrelation by permutation test

rm(list = ls())

library(tidyverse)
library(nmgc)

data <- read.csv("data/reflectance.csv", header = TRUE)

# Spatial autocorrelation test
res_cortest <- nspcortest(
  data, variables = paste0("PC", 1:4), nesting = "island", nperm = 1000, seed = 42,
  to_pcomp = paste0("wl", 300:400)
)

# Results of the test
res_cortest$res
write.csv(res_cortest$res, "table_spatial.csv", row.names = FALSE)

# Table with multivariate means per site
res_cortest$sites
write.csv(res_cortest$sites, "table_sites.csv", row.names = FALSE)
